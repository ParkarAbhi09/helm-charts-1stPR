# Jenkins Jobs Helm Chart

This helm chart generates a Jenkins job-dsl configuration from a YAML definition to allow configuring Jenkins jobs as code in a simpler way.

It was created to allow defining credentials at job level to solve <https://github.com/jenkins-infra/helpdesk/issues/2840>.

IMPORTANT: the generated job-dsl is aimed at the Jenkins Infrastructure. You might be able to adapt to your needs but it's not the goal (better to contribute to the official Jenkins helm chart or JCasc).

## Usage

The following [Jenkins Plugins](https://plugins.jenkins.io/) are required by the Jenkins JobDSL code generated by this chart:

- basic-branch-build-strategies
- github-branch-source
- github-checks
- github-label-filter
- github-scm-trait-notification-context
- job-dsl
- scm-filter-branch-pr

Install this helm chart by specifying the jobs definitions as helm values (look at the default `./values.yaml` file: there is a commented example).

Don't forget to also specify the value `jenkinsName` to the name of your Jenkins helm chart installation:
it creates a config map with the generated Job-DSL configuration that will be picked by the "kiwi" sidecar of the Jenkins pod, and mounted along your actual JCasc configurations.

## Testing

### Unit Tests

This charts has automated unit tests requiring <https://github.com/helm-unittest/helm-unittest> (check GitHub Action Workflow / Jenkins Pipeline for exact version) to be executed:

```shell
helm unittest .
```

### Manual Tests / Prototyping

If you want to prototype or manually test the chart, we provide tooling to quickly get a Kubernetes Jenkins instance with this chart already setup.

Requirements:

- Docker Desktop or Docker CE >= 27.x
- [k3d](https://k3d.io/) CLI
- [helmfile](https://github.com/roboll/helmfile) CLI

```shell
# Start a local Kubernetes (k3s) in Docker cluster
## You can fine tune the Kubernetes version with the file tests/manual/k3d.yaml (and other parameters)
k3d cluster create --config=./tests/manual/k3d.yaml

# Now your $KUBECONFIG is set to use this cluster named 'jenkins-jobs'. You can install the Jenkins + this chart in it for testing
## You can specify custom values for the jenkins-jobs chart with the file ./
helmfile apply -f ./tests/manual/helmfile-k3d.yaml
```

You can clean up with the following command:

```shell
k3d cluster delete --config=./tests/manual/k3d.yaml
```
